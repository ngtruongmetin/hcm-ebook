<%- include('partials/header', { title: lesson.title }) %>

<style>
  .lesson-hero {
    background: linear-gradient(90deg,#0a7cad,#07648c);
    color:#fff;
    padding:25px 0;
    margin-bottom:20px;
    border-radius:6px;
  }
  .lesson-hero h1 {
    font-size:28px;
    font-weight:700;
    margin:0;
    text-align: center;
  }
  .lesson-section-title {
    margin-top:25px;
    margin-bottom:10px;
    font-weight:700;
  }
  .attachment-box {
    background:#f8f8f8;
    padding:12px;
    border-radius:6px;
    border:1px solid #e0e0e0;
  }

  /* ===== responsive content wrapper ===== */
  .lesson-content { 
    width: 100%;
    box-sizing: border-box;
    word-break: break-word; /* tr√°nh text d√†i tr√†n */
  }

  /* images: scale down on small screens */
  .lesson-content img,
  .lesson-content picture,
  .lesson-content svg {
    max-width: 100% !important;   /* b·∫Øt bu·ªôc kh√¥ng tr√†n khung */
    height: auto !important;
    display: block;
    margin: 0.6rem auto;
    border-radius: 6px;
    object-fit: contain;
  }

  /* iframes / videos (YouTube, embedded) */
  .lesson-content iframe,
  .lesson-content video,
  .lesson-content embed,
  .lesson-content object {
    max-width: 100% !important;
    width: 100% !important;
    height: auto !important;
  }

  /* tables: allow horizontal scroll on small screens */
  .lesson-content table {
    width: 100%;
    border-collapse: collapse;
  }
  .lesson-content .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* prevent large inline styles from breaking layout (extra safety) */
  .lesson-content [style*="width:"] {
    max-width: 100% !important;
    width: auto !important;
  }

  /* small-screen tweaks */
  @media (max-width: 576px) {
    .lesson-hero h1 { font-size: 18px; }
    .card.p-4 { padding: 12px; }
  }
</style>

<div class="container">

  <!-- HERO -->
  <div class="lesson-hero">
    <div class="container">
      <h1><%= lesson.title %></h1>
    </div>
  </div>

  <!-- OBJECTIVES -->
  <% if (lesson.objectives) { %>
    <h4 class="lesson-section-title">üéØ M·ª•c ti√™u</h4>
    <div class="card p-3 mb-3">
      <%= lesson.objectives %>
    </div>
  <% } %>

  <!-- CONTENT -->
  <h4 class="lesson-section-title">üìò N·ªôi dung b√†i h·ªçc</h4>
  <div class="card p-4 mb-4">
    <div class="lesson-content">
      <%- lesson.content || '<p>(Kh√¥ng c√≥ n·ªôi dung)</p>' %>
    </div>
  </div>

  <!-- ATTACHMENT -->
  <% if (lesson.attachment) { %>
    <h4 class="lesson-section-title">üìé T·∫≠p tin ƒë√≠nh k√®m</h4>
    <div class="attachment-box mb-4">
      <a href="<%= lesson.attachment %>" target="_blank" rel="noopener" class="font-weight-bold">
        ‚ûú T·∫£i xu·ªëng t√†i li·ªáu
      </a>
    </div>
  <% } %>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const wrapper = document.querySelector('.lesson-content');
  if (!wrapper) return;

  // x·ª≠ l√Ω ·∫£nh: lo·∫°i b·ªè width/height inline v√† ƒë·∫£m b·∫£o responsive
  wrapper.querySelectorAll('img').forEach(img => {
    try {
      img.removeAttribute('width');
      img.removeAttribute('height');
      img.style.maxWidth = '100%';
      img.style.height = 'auto';
      img.classList.add('responsive-img');
    } catch(e) { /* silently fail */ }
  });

  // x·ª≠ l√Ω iframe / embed / video
  wrapper.querySelectorAll('iframe, embed, object, video').forEach(el => {
    try {
      el.removeAttribute('width');
      el.removeAttribute('height');
      el.style.width = '100%';
      el.style.height = 'auto';
      // n·∫øu c·∫ßn, c√≥ th·ªÉ b·ªçc b·∫±ng container ƒë·ªÉ gi·ªØ ratio (t√πy ch·ªânh th√™m)
    } catch(e) { /* silently fail */ }
  });

  // b·ªçc table n·∫øu c·∫ßn ƒë·ªÉ cu·ªôn ngang tr√™n m√†n h√¨nh nh·ªè
  wrapper.querySelectorAll('table').forEach(table => {
    try {
      if (!table.parentElement || !table.parentElement.classList.contains('table-responsive')) {
        const wrap = document.createElement('div');
        wrap.className = 'table-responsive';
        table.parentNode.insertBefore(wrap, table);
        wrap.appendChild(table);
      }
    } catch(e) { /* silently fail */ }
  });

  // x·ª≠ l√Ω c√°c ph·∫ßn t·ª≠ c√≥ inline style ch·ª©a width: (bi·ªán ph√°p b·ªï sung)
  wrapper.querySelectorAll('[style]').forEach(el => {
    try {
      const style = el.getAttribute('style') || '';
      if (/width\s*:\s*\d+\s*(px|em|rem|%|vw)/i.test(style)) {
        // th√™m max-width override (CSS s·∫Ω ∆∞u ti√™n !important)
        el.style.maxWidth = '100%';
        el.style.width = 'auto';
      }
    } catch(e) { /* silently fail */ }
  });
});
</script>

<%- include('partials/footer') %>
